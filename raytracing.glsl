//#version 300 es

#define USE_BVH

#ifdef DEBUG
precision mediump float;
out vec4 frag_color;

uniform vec4 iMouse;
uniform vec3 iResolution;
uniform float iTime;
uniform float iTimeDelta;
uniform int iFrame;
uniform float iFrameRate;

#endif

// random numbers utilities from https://www.shadertoy.com/view/tsf3Dn
#define MIN -2147483648
#define MAX 2147483647

int xorshift(in int value) {
    // Xorshift*32
    // Based on George Marsaglia's work: http://www.jstatsoft.org/v08/i14/paper
    value ^= value << 13;
    value ^= value >> 17;
    value ^= value << 5;
    return value;
}

int nextInt(in int seed) {
    return xorshift(seed);
}

float nextFloat(inout int seed) {
    seed = xorshift(seed);
    // FIXME: This should have been a seed mapped from MIN..MAX to 0..1 instead
    return abs(fract(float(seed) / 3141.592653));
}

float nextFloat(inout int seed, in float max) {
    return nextFloat(seed) * max;
}

float random(inout int rngSeed)
{
    return nextFloat(rngSeed);
}

float random(inout int seed, float minValue, float maxValue)
{
    return minValue + (maxValue-minValue)*random(seed);
}

int randomSeed;
float random()
{
    return nextFloat(randomSeed);
}
float random(float minValue, float maxValue)
{
    return minValue + (maxValue-minValue)*random(randomSeed);
}


//==================================================================


// vec4 vec3 shape position + index properties
// properties
struct Item
{
    vec4 center0; // xyz + time as w
    vec4 center1;
    vec4 material; // xyz color
                   // w > 1 = glass (ior)
                   // w < 0.5 = metal (roughness)
                   // w = 0 = lambert
    float radius;
};

struct BVH
{
    vec3 min; // aabb min
    vec3 max; // aabb max
    ivec2 nodes; // if nodes[0] is -1 then nodes [1] is items
                 // otherwise
                 // nodes[0] = left child
                 // nodes[1] = right child
};

struct Camera
{
    vec3 position;
    vec3 lookAt;
    vec3 u;
    vec3 v;
    vec3 w;
    vec3 vecX;
    vec3 vecY;
    vec2 time;
    float lensRadius;
};

#define MaterialLambert 0.0
#define MaterialMetal 0.5
#define MaterialDielectric 1.0

#define NumItems 125
Item Items[NumItems] = Item[NumItems](
Item(vec4(0.0,-1000,-1.0,0.0), vec4(0.0,-1000,-1.0,0.0), vec4(0.5,0.5,0.5,0.0), 1000.0 ),
Item(vec4(0.0,1.0,0.0,0.0), vec4(0.0,1.0,0.0,0.0), vec4(0.0,0.0,0.0,1.5), 1.0 ),
Item(vec4(-4.0,1.0,0.0,0.0), vec4(-4.0,1.0,0.0,0.0), vec4(0.4,0.2,0.1,0.0), 1.0 ),
Item(vec4(4.0,1.0,0.0,0.0), vec4(4.0,1.0,0.0,0.0), vec4(0.7,0.6,0.5,0.001), 1.0 ),
Item(vec4(-10.87907218029884,0.2,-10.23730963675649,0.0), vec4(-10.87907218029884,0.33436424411240123,-10.23730963675649,1.0), vec4(0.018053750095896947,0.7181439384994028,0.5833516685928719,0.0), 0.2 ),
Item(vec4(-10.77043787683452,0.2,-8.554108421617252,0.0), vec4(-10.77043787683452,0.4550690257394217,-8.554108421617252,1.0), vec4(0.06506020789165777,0.24545592552179912,0.20204221732491356,0.0), 0.2 ),
Item(vec4(-10.413566324549514,0.2,-6.290148983978038,0.0), vec4(-10.413566324549514,0.8515929727227629,-6.290148983978038,1.0), vec4(0.4245734021016873,0.622084524626434,0.00880962202943013,0.0), 0.2 ),
Item(vec4(-10.974487271130194,0.2,-4.247811406472117,0.0), vec4(-10.974487271130194,0.22834747652200632,-4.247811406472117,1.0), vec4(0.000803579425165699,0.6985033089301906,0.18728733506313708,0.0), 0.2 ),
Item(vec4(-10.313947925787852,0.2,-2.9981045519840004,0.0), vec4(-10.313947925787852,0.962280082457942,-2.9981045519840004,1.0), vec4(0.5810709241120868,4.435460717724579e-06,0.19836975262800935,0.0), 0.2 ),
Item(vec4(-10.350613970893296,0.2,-0.7941140008565926,0.0), vec4(-10.350613970893296,0.9215400323407825,-0.7941140008565926,1.0), vec4(0.5206200182703375,0.052332153880591536,0.893536687872996,0.0), 0.2 ),
Item(vec4(-10.188715288149664,0.2,1.027530984730198,0.0), vec4(-10.188715288149664,0.2,1.027530984730198,0.0), vec4(0.9507137288057418,0.5152949915167768,0.5127229304967305,0.024989091686441235), 0.2 ),
Item(vec4(-10.512728774485852,0.2,3.8452342465006595,0.0), vec4(-10.512728774485852,0.7414124727934965,3.8452342465006595,1.0), vec4(0.29312746569636866,0.8820011499475774,0.14531667083145117,0.0), 0.2 ),
Item(vec4(-10.805060542582448,0.2,5.379904918024446,0.0), vec4(-10.805060542582448,0.4165993971306134,5.379904918024446,1.0), vec4(0.04691529883734517,0.1781824033816799,0.0008433673429686043,0.0), 0.2 ),
Item(vec4(-10.800477500354269,0.2,7.394098834285515,0.0), vec4(-10.800477500354269,0.42169166627303506,7.394098834285515,1.0), vec4(0.049147194894914745,0.19174554467308852,0.24582977870409453,0.0), 0.2 ),
Item(vec4(-10.790223994768185,0.2,9.207779887386886,0.0), vec4(-10.790223994768185,0.43308445025757264,9.207779887386886,1.0), vec4(0.05432836095187485,0.05329936000309503,0.0478651422985551,0.0), 0.2 ),
Item(vec4(-8.586356880836039,0.2,-10.739196546868563,0.0), vec4(-8.586356880836039,0.6596034657377337,-10.739196546868563,1.0), vec4(0.21123534571813604,0.08397338415466872,0.0004618074324156317,0.0), 0.2 ),
Item(vec4(-8.246179821903684,0.2,-8.49919110961281,0.0), vec4(-8.246179821903684,0.2,-8.49919110961281,0.0), vec4(0.9187889878312865,0.7782271613262167,0.8211471814662228,0.2826626180996924), 0.2 ),
Item(vec4(-8.832684360694754,0.2,-6.106710929041541,0.0), vec4(-8.832684360694754,0.3859062658947177,-6.106710929041541,1.0), vec4(0.03456113969891748,0.9851424250541063,0.7395080323870683,0.0), 0.2 ),
Item(vec4(-8.891199036174774,0.2,-4.700574333175884,0.0), vec4(-8.891199036174774,0.3208899598058064,-4.700574333175884,1.0), vec4(0.01461438238184949,0.11068608636181065,0.5205397503857797,0.0), 0.2 ),
Item(vec4(-8.359927407274249,0.2,-2.1572034718804862,0.0), vec4(-8.359927407274249,0.9111917696952796,-2.1572034718804862,1.0), vec4(0.5057937332823037,0.8769209726053163,0.17817431941642617,0.0), 0.2 ),
Item(vec4(-8.252967876053106,0.2,-0.3967249902273361,0.0), vec4(-8.252967876053106,0.2,-0.3967249902273361,0.0), vec4(0.9150178466371635,0.8351527832070356,0.6516842554664588,0.3384497275428948), 0.2 ),
Item(vec4(-8.471177454470796,0.2,1.794231100748672,0.0), vec4(-8.471177454470796,0.7875806061435595,1.794231100748672,1.0), vec4(0.3452509687160327,0.778769186909194,0.716050070954741,0.0), 0.2 ),
Item(vec4(-8.54524456147836,0.2,3.5301020321842964,0.0), vec4(-8.54524456147836,0.7052838205796004,3.5301020321842964,1.0), vec4(0.25531173933951784,0.34692365990854435,0.0011920329476392878,0.0), 0.2 ),
Item(vec4(-8.78153402381124,0.2,5.7176638227988725,0.0), vec4(-8.78153402381124,0.44273997354306766,5.7176638227988725,1.0), vec4(0.05892269475568918,0.6358535340176439,0.17165609001660198,0.0), 0.2 ),
Item(vec4(-8.844293338578854,0.2,7.493918885249338,0.0), vec4(-8.844293338578854,0.37300740157905093,7.493918885249338,1.0), vec4(0.02993156100113499,0.30118008050117084,0.49426631312582386,0.0), 0.2 ),
Item(vec4(-8.392962752547906,0.2,9.337232718451476,0.0), vec4(-8.392962752547906,0.8744858305023273,9.337232718451476,1.0), vec4(0.45493113554841413,0.14040235357305267,0.1926873126513799,0.0), 0.2 ),
Item(vec4(-6.542416160575017,0.2,-10.299401646499868,0.0), vec4(-6.542416160575017,0.7084264882499818,-10.299401646499868,1.0), vec4(0.2584974939542089,0.6059729048482652,0.27137683494528764,0.0), 0.2 ),
Item(vec4(-6.646070414532197,0.2,-8.559275831583967,0.0), vec4(-6.646070414532197,0.5932550949642261,-8.559275831583967,1.0), vec4(0.15464956971532245,0.2397997439827201,0.0008746784936438512,0.0), 0.2 ),
Item(vec4(-6.960861438679125,0.2,-6.366956120256548,0.0), vec4(-6.960861438679125,0.24348729035652744,-6.366956120256548,1.0), vec4(0.0018911444225529236,0.4947463625686946,0.9666580874686073,0.0), 0.2 ),
Item(vec4(-6.4661346426579485,0.2,-4.645760282259878,0.0), vec4(-6.4661346426579485,0.7931837303800575,-4.645760282259878,1.0), vec4(0.3518669379876008,0.15492071311679226,0.029018848869375655,0.0), 0.2 ),
Item(vec4(-6.547985297409865,0.2,-2.116131026215319,0.0), vec4(-6.547985297409865,0.7022385584334832,-2.116131026215319,1.0), vec4(0.25224356957734323,0.9644745219989935,0.5937059090147154,0.0), 0.2 ),
Item(vec4(-6.514344296395199,0.2,-0.2257391989715054,0.0), vec4(-6.514344296395199,0.7396174484497788,-0.2257391989715054,1.0), vec4(0.29118699067144965,0.740098503715168,0.053905754442333344,0.0), 0.2 ),
Item(vec4(-6.537605503131127,0.2,1.8572206494414427,0.0), vec4(-6.537605503131127,0.713771663187637,1.8572206494414427,1.0), vec4(0.2639613218945907,0.9071941257145785,0.3338468399220292,0.0), 0.2 ),
Item(vec4(-6.586781441280398,0.2,3.242351529697279,0.0), vec4(-6.586781441280398,0.6591317319106684,3.242351529697279,1.0), vec4(0.21080194724728984,0.07251143697112489,0.30029995518862884,0.0), 0.2 ),
Item(vec4(-6.138595346685796,0.2,5.005138216505354,0.0), vec4(-6.138595346685796,0.2,5.005138216505354,0.0), vec4(1.5,1.5,1.5,1.5), 0.2 ),
Item(vec4(-6.261562679267066,0.2,7.797561622743407,0.0), vec4(-6.261562679267066,0.2,7.797561622743407,0.0), vec4(0.910242955962741,0.9430897904130041,0.8702517059165982,0.44422799460474405), 0.2 ),
Item(vec4(-6.271774089214769,0.2,9.466810455170702,0.0), vec4(-6.271774089214769,0.2,9.466810455170702,0.0), vec4(0.9045699504362398,0.759339141761501,0.7806789323891895,0.264152358926271), 0.2 ),
Item(vec4(-4.616518388280665,0.2,-10.949489032231334,0.0), vec4(-4.616518388280665,0.6260906796881502,-10.949489032231334,1.0), vec4(0.1815532673171098,0.003149824524601547,0.756917670110481,0.0), 0.2 ),
Item(vec4(-4.487000599511258,0.2,-8.820144521840572,0.0), vec4(-4.487000599511258,0.7699993338763802,-8.820144521840572,1.0), vec4(0.3248992406195172,0.039935793856736734,0.2547427502416103,0.0), 0.2 ),
Item(vec4(-4.56356739899504,0.2,-6.67888903190954,0.0), vec4(-4.56356739899504,0.6849251122277342,-6.67888903190954,1.0), vec4(0.23515236446908055,0.12729907879999075,0.11976992603193656,0.0), 0.2 ),
Item(vec4(-4.51536908383594,0.2,-4.438859492482245,0.0), vec4(-4.51536908383594,0.7384787957378443,-4.438859492482245,1.0), vec4(0.28995941345927906,0.38873909774973237,0.3750980216184358,0.0), 0.2 ),
Item(vec4(-4.587667879910248,0.2,-2.9748225143245417,0.0), vec4(-4.587667879910248,0.6581468000997244,-2.9748225143245417,1.0), vec4(0.20989849044161685,0.0007825997344912333,0.052718470387723135,0.0), 0.2 ),
Item(vec4(-4.8405098669552755,0.2,-0.4739852162994028,0.0), vec4(-4.8405098669552755,0.3772112589385827,-0.4739852162994028,1.0), vec4(0.0314038302945974,0.3415945094710939,0.74133625846794,0.0), 0.2 ),
Item(vec4(-4.281404953480316,0.2,1.7173878063719465,0.0), vec4(-4.281404953480316,0.9984389405774261,1.7173878063719465,1.0), vec4(0.6375047418304025,0.6353645243594489,0.6665699800480549,0.0), 0.2 ),
Item(vec4(-4.770235363921425,0.2,3.7575703490466865,0.0), vec4(-4.770235363921425,0.45529404008730595,3.7575703490466865,1.0), vec4(0.06517504690409898,0.708534362660146,0.45308181812852494,0.0), 0.2 ),
Item(vec4(-4.925089275976492,0.2,5.015021567104004,0.0), vec4(-4.925089275976492,0.2832341378038979,5.015021567104004,1.0), vec4(0.006927921695958262,0.0002785771336544251,0.00021199286981116332,0.0), 0.2 ),
Item(vec4(-4.319971902273021,0.2,7.224603303088081,0.0), vec4(-4.319971902273021,0.9555867752521983,7.224603303088081,1.0), vec4(0.5709113749360158,0.062279807108736006,0.011987759506803137,0.0), 0.2 ),
Item(vec4(-4.437678124262772,0.2,9.309980577686845,0.0), vec4(-4.437678124262772,0.8248020841524764,9.309980577686845,1.0), vec4(0.3903776443612781,0.1186271093124326,0.00483238785228699,0.0), 0.2 ),
Item(vec4(-2.8563370277755373,0.2,-10.525357640856788,0.0), vec4(-2.8563370277755373,0.3596255246938475,-10.525357640856788,1.0), vec4(0.025480308133786118,0.27813008530004124,0.028272722940143293,0.0), 0.2 ),
Item(vec4(-2.754377006863188,0.2,-8.359569065533254,0.0), vec4(-2.754377006863188,0.4729144368186801,-8.359569065533254,1.0), vec4(0.07448228982405733,0.506360224471542,0.20675357236618377,0.0), 0.2 ),
Item(vec4(-2.7101984102514067,0.2,-6.573606087246749,0.0), vec4(-2.7101984102514067,0.522001766387326,-6.573606087246749,1.0), vec4(0.10368513755655802,0.2244589738679346,0.0005585932598424232,0.0), 0.2 ),
Item(vec4(-2.652098605714677,0.2,-4.621173188711832,0.0), vec4(-2.652098605714677,0.5865571047614699,-4.621173188711832,1.0), vec4(0.14942639524157,0.17717253450711293,0.03535878013135713,0.0), 0.2 ),
Item(vec4(-2.902114476799128,0.2,-2.190163349679582,0.0), vec4(-2.902114476799128,0.30876169244541335,-2.190163349679582,1.0), vec4(0.011829105743590682,0.8096733335829571,0.2602183139988257,0.0), 0.2 ),
Item(vec4(-2.8118181067034067,0.2,-0.45491622396938514,0.0), vec4(-2.8118181067034067,0.4090909925517701,-0.45491622396938514,1.0), vec4(0.04371904316628438,0.3668102751750537,0.6675538197030474,0.0), 0.2 ),
Item(vec4(-2.9812637023416415,0.2,1.0160780687450157,0.0), vec4(-2.9812637023416415,0.22081810850928735,1.0160780687450157,1.0), vec4(0.0004333936419044618,0.00031914110440673304,0.021451041400805424,0.0), 0.2 ),
Item(vec4(-2.353048074514389,0.2,3.144204833366734,0.0), vec4(-2.353048074514389,0.9188354727617898,3.144204833366734,1.0), vec4(0.5167244369006659,0.025672881439910585,0.4964690908007147,0.0), 0.2 ),
Item(vec4(-2.389641784250747,0.2,5.490231947221014,0.0), vec4(-2.389641784250747,0.8781757952769476,5.490231947221014,1.0), vec4(0.4599224092995202,0.29670044700753956,0.04866424882766839,0.0), 0.2 ),
Item(vec4(-2.121964933963905,0.2,7.7180297719355355,0.0), vec4(-2.121964933963905,0.2,7.7180297719355355,0.0), vec4(1.5,1.5,1.5,1.5), 0.2 ),
Item(vec4(-2.7991237977779964,0.2,9.58365577628933,0.0), vec4(-2.7991237977779964,0.42319578024667076,9.58365577628933,1.0), vec4(0.04981635631992014,0.42056057431592747,0.1559444381900457,0.0), 0.2 ),
Item(vec4(-0.48173863349074897,0.2,-10.710878771589387,0.0), vec4(-0.48173863349074897,0.7758459627880567,-10.710878771589387,1.0), vec4(0.33159857285930394,0.10319887002180457,0.39809520364288686,0.0), 0.2 ),
Item(vec4(-0.9470933954141578,0.2,-8.731254645339288,0.0), vec4(-0.9470933954141578,0.2587851162064913,-8.731254645339288,1.0), vec4(0.0034556898874106854,0.08916551315026158,0.9368368178010483,0.0), 0.2 ),
Item(vec4(-0.21201918018835664,0.2,-6.724252041700079,0.0), vec4(-0.21201918018835664,0.2,-6.724252041700079,0.0), vec4(0.9377671221175796,0.653193310166623,0.9292572031782796,0.1601294439632905), 0.2 ),
Item(vec4(-0.7206727353821794,0.2,-4.154640411078246,0.0), vec4(-0.7206727353821794,0.510363627353134,-4.154640411078246,1.0), vec4(0.09632558118379506,0.8822627587431571,0.5533010975031916,0.0), 0.2 ),
Item(vec4(-0.625444963511477,0.2,-2.7728777079481484,0.0), vec4(-0.625444963511477,0.6161722627650255,-2.7728777079481484,1.0), vec4(0.17319935229496145,0.06368461178627983,7.191485145271074e-05,0.0), 0.2 ),
Item(vec4(-0.209153891612038,0.2,-0.9658751224612775,0.0), vec4(-0.209153891612038,0.2,-0.9658751224612775,0.0), vec4(0.9393589491044233,0.5189582652992903,0.9097070553063986,0.028579099993304484), 0.2 ),
Item(vec4(-0.1340189873372638,0.2,1.5132525132206622,0.0), vec4(-0.1340189873372638,0.2,1.5132525132206622,0.0), vec4(1.5,1.5,1.5,1.5), 0.2 ),
Item(vec4(-0.218997042008506,0.2,3.8763977125437226,0.0), vec4(-0.218997042008506,0.2,3.8763977125437226,0.0), vec4(0.9338905322174966,0.9868876180798458,0.8520115711650357,0.4871498657182489), 0.2 ),
Item(vec4(-0.5420136285298985,0.2,5.340171950909247,0.0), vec4(-0.5420136285298985,0.7088737460778904,5.340171950909247,1.0), vec4(0.2589524894473454,0.14286043973506582,0.12036103866340311,0.0), 0.2 ),
Item(vec4(-0.8148144184347658,0.2,7.606737712822178,0.0), vec4(-0.8148144184347658,0.4057617572947047,7.606737712822178,1.0), vec4(0.04233790076500496,0.4544822866181326,0.18744580736077854,0.0), 0.2 ),
Item(vec4(-0.8252932195133293,0.2,9.093981800557364,0.0), vec4(-0.8252932195133293,0.3941186449851896,9.093981800557364,1.0), vec4(0.03768204833088608,0.010904418316054449,0.4434994294710523,0.0), 0.2 ),
Item(vec4(1.2664654057748364,0.2,-10.550180069986878,0.0), vec4(1.2664654057748364,0.49607267308315156,-10.550180069986878,1.0), vec4(0.08765902774660274,0.2497999622679129,0.1058497951466909,0.0), 0.2 ),
Item(vec4(1.7844593566811997,0.2,-8.190289557328697,0.0), vec4(1.7844593566811997,0.2,-8.190289557328697,0.0), vec4(0.9358107537117776,0.9498391348173906,0.5090464918202359,0.4508423521210428), 0.2 ),
Item(vec4(1.1807677102966834,0.2,-6.705033365413359,0.0), vec4(1.1807677102966834,0.4008530114407594,-6.705033365413359,1.0), vec4(0.04034193220482182,0.10741396977699859,0.9742671456617958,0.0), 0.2 ),
Item(vec4(1.704430338156438,0.2,-4.69481391693416,0.0), vec4(1.704430338156438,0.9827003757293755,-4.69481391693416,1.0), vec4(0.6126198781669057,0.11498585839144444,0.04538169414605097,0.0), 0.2 ),
Item(vec4(1.607009562751387,0.2,-2.246069036861432,0.0), vec4(1.607009562751387,0.8744550697237632,-2.246069036861432,1.0), vec4(0.4548896410760863,0.7017430829370971,0.8689734827554322,0.0), 0.2 ),
Item(vec4(1.3094648333117378,0.2,-0.2058461177801828,0.0), vec4(1.3094648333117378,0.5438498147908197,-0.2058461177801828,1.0), vec4(0.11823269513168107,0.7786177637590214,0.4721204024192322,0.0), 0.2 ),
Item(vec4(1.4360488503512445,0.2,1.886957406843218,0.0), vec4(1.4360488503512445,0.6844987226124941,1.886957406843218,1.0), vec4(0.23473901221313845,0.9712264710543774,0.05505613367647005,0.0), 0.2 ),
Item(vec4(1.6529186676171452,0.2,3.076212207374836,0.0), vec4(1.6529186676171452,0.9254651862412724,3.076212207374836,1.0), vec4(0.5262997364480841,0.0071707414233888565,0.028796101759333715,0.0), 0.2 ),
Item(vec4(1.8198890051572612,0.2,5.191671375492282,0.0), vec4(1.8198890051572612,0.2,5.191671375492282,0.0), vec4(0.9554938917540339,0.6064840974957121,0.8795580913582202,0.11435441554579784), 0.2 ),
Item(vec4(1.5401879471190245,0.2,7.75701897613527,0.0), vec4(1.5401879471190245,0.8002088301322496,7.75701897613527,1.0), vec4(0.3602506397687236,0.7075033706529529,0.13550349922642935,0.0), 0.2 ),
Item(vec4(1.3062567115017893,0.2,9.262093758670021,0.0), vec4(1.3062567115017893,0.540285235001988,9.262093758670021,1.0), vec4(0.11579404116035823,0.08480634362194978,0.7524171503515334,0.0), 0.2 ),
Item(vec4(3.54358427600254,0.2,-10.141123288545028,0.0), vec4(3.54358427600254,0.8039825288917113,-10.141123288545028,1.0), vec4(0.3647948952064268,0.9107027228144511,0.7872393660484028,0.0), 0.2 ),
Item(vec4(3.1218113796559077,0.2,-8.503946573337705,0.0), vec4(3.1218113796559077,0.33534597739545297,-8.503946573337705,1.0), vec4(0.01831853359713046,0.30378889148568483,0.010873275210947669,0.0), 0.2 ),
Item(vec4(3.0352240187372197,0.2,-6.934125923050886,0.0), vec4(3.0352240187372197,0.2391377985969106,-6.934125923050886,1.0), vec4(0.0015317672790123357,0.005357276560367593,0.7502476233031057,0.0), 0.2 ),
Item(vec4(3.709304803852704,0.2,-4.254344625677798,0.0), vec4(3.709304803852704,0.9881164487252263,-4.254344625677798,1.0), vec4(0.6211275367512623,0.6864221447599795,0.11621108104111726,0.0), 0.2 ),
Item(vec4(3.553667429303133,0.2,-2.2962867585305204,0.0), vec4(3.553667429303133,0.8151860325590365,-2.2962867585305204,1.0), vec4(0.378453854655728,0.6113732422462737,0.1429139609722657,0.0), 0.2 ),
Item(vec4(3.513703373039121,0.2,-0.7986573345261077,0.0), vec4(3.513703373039121,0.7707815255990234,-0.7986573345261077,1.0), vec4(0.3257915499651485,0.0500479863458416,0.006681960940012267,0.0), 0.2 ),
Item(vec4(3.2400512786835627,0.2,1.8016913150697749,0.0), vec4(3.2400512786835627,0.46672364298173635,1.8016913150697749,1.0), vec4(0.07114150172544875,0.7934678576028457,0.3186002275548872,0.0), 0.2 ),
Item(vec4(3.8325604818976258,0.2,3.4119923331371207,0.0), vec4(3.8325604818976258,0.2,3.4119923331371207,0.0), vec4(0.9625336010542367,0.7288846295206226,0.6385913830538492,0.2343069369302102), 0.2 ),
Item(vec4(3.708313197204296,0.2,5.744991340981157,0.0), vec4(3.708313197204296,0.9870146635603287,5.744991340981157,1.0), vec4(0.6193920806589776,0.6852001211566693,0.00015330759653309933,0.0), 0.2 ),
Item(vec4(3.6033704751215376,0.2,7.082514810354866,0.0), vec4(3.6033704751215376,0.8704116390239309,7.082514810354866,1.0), vec4(0.4494517657387535,0.008405794972715435,0.013248585144351007,0.0), 0.2 ),
Item(vec4(3.796554063341695,0.2,9.036021183201148,0.0), vec4(3.796554063341695,0.2,9.036021183201148,0.0), vec4(0.9425300351898305,0.5200117684450823,0.6198166824337547,0.029611533076180696), 0.2 ),
Item(vec4(5.88934264874543,0.2,-10.621087771312759,0.0), vec4(5.88934264874543,0.2,-10.621087771312759,0.0), vec4(1.5,1.5,1.5,1.5), 0.2 ),
Item(vec4(5.150645093715198,0.2,-8.78272174341194,0.0), vec4(5.150645093715198,0.3673834374613318,-8.78272174341194,1.0), vec4(0.028017215136371565,0.058283754056723834,0.5535455478482404,0.0), 0.2 ),
Item(vec4(5.0925507313876786,0.2,-6.1803120235486,0.0), vec4(5.0925507313876786,0.3028341459863098,-6.1803120235486,1.0), vec4(0.010574861580733676,0.8294918256036924,0.14309369341038963,0.0), 0.2 ),
Item(vec4(5.87323763287539,0.2,-4.18169954466436,0.0), vec4(5.87323763287539,0.2,-4.18169954466436,0.0), vec4(1.5,1.5,1.5,1.5), 0.2 ),
Item(vec4(5.228069122437014,0.2,-2.5706909136249587,0.0), vec4(5.228069122437014,0.45341013604112673,-2.5706909136249587,1.0), vec4(0.06421669704838236,0.2275386316594722,0.010025845468250343,0.0), 0.2 ),
Item(vec4(5.586845179540475,0.2,-0.964341807927666,0.0), vec4(5.586845179540475,0.8520501994894172,-0.964341807927666,1.0), vec4(0.4251694626541888,0.001569761310947488,0.00011037921973330009,0.0), 0.2 ),
Item(vec4(5.884325263895417,0.2,1.265994874044026,0.0), vec4(5.884325263895417,0.2,1.265994874044026,0.0), vec4(1.5,1.5,1.5,1.5), 0.2 ),
Item(vec4(5.404860081167088,0.2,3.281952774962035,0.0), vec4(5.404860081167088,0.6498445346300978,3.281952774962035,1.0), vec4(0.20236010533656923,0.09814489791208893,0.003964564785744056,0.0), 0.2 ),
Item(vec4(5.8220528154493465,0.2,5.872831949154304,0.0), vec4(5.8220528154493465,0.2,5.872831949154304,0.0), vec4(0.9566960085829702,0.9849066384190578,0.984898252248235,0.48520850565067664), 0.2 ),
Item(vec4(5.1002260791142024,0.2,7.193673943032489,0.0), vec4(5.1002260791142024,0.3113623101268919,7.193673943032489,1.0), vec4(0.01240156411679805,0.04630814346882919,0.38168534098961276,0.0), 0.2 ),
Item(vec4(5.881957597301069,0.2,9.488621877736245,0.0), vec4(5.881957597301069,0.2,9.488621877736245,0.0), vec4(1.5,1.5,1.5,1.5), 0.2 ),
Item(vec4(7.595650985987814,0.2,-10.76682260733172,0.0), vec4(7.595650985987814,0.8618344288753492,-10.76682260733172,1.0), vec4(0.4380248112447597,0.06712555117478701,0.29333301119244504,0.0), 0.2 ),
Item(vec4(7.276589006031262,0.2,-8.778256923523417,0.0), vec4(7.276589006031262,0.5073211178125134,-8.778256923523417,1.0), vec4(0.0944462694535328,0.06070369378432067,0.006620875980081902,0.0), 0.2 ),
Item(vec4(7.252708051208208,0.2,-6.114960954502537,0.0), vec4(7.252708051208208,0.4807867235646755,-6.114960954502537,1.0), vec4(0.0788411841301855,0.9670297679692086,0.20061641707474612,0.0), 0.2 ),
Item(vec4(7.586809481061404,0.2,-4.420880527757142,0.0), vec4(7.586809481061404,0.8520105345126705,-4.420880527757142,1.0), vec4(0.42511773711549833,0.4140485964578343,0.8849814413510543,0.0), 0.2 ),
Item(vec4(7.351430696025031,0.2,-2.7238941346336376,0.0), vec4(7.351430696025031,0.5904785511389232,-2.7238941346336376,1.0), vec4(0.15247349889955264,0.09411660356754042,0.10708694348643627,0.0), 0.2 ),
Item(vec4(7.285061632197042,0.2,-0.23757871075640646,0.0), vec4(7.285061632197042,0.5167351468856021,-0.23757871075640646,1.0), vec4(0.10032115327264395,0.7176373114714362,0.7983426887471613,0.0), 0.2 ),
Item(vec4(7.2725283967052645,0.2,1.3009000650856857,0.0), vec4(7.2725283967052645,0.5028093296725162,1.3009000650856857,1.0), vec4(0.09169349013671865,0.11177882613403688,0.2961813014417699,0.0), 0.2 ),
Item(vec4(7.521086892685376,0.2,3.536366286000904,0.0), vec4(7.521086892685376,0.7789854363170838,3.536366286000904,1.0), vec4(0.33522413546728397,0.3551713490844487,0.0600730315134353,0.0), 0.2 ),
Item(vec4(7.018336625601627,0.2,5.219383369845124,0.0), vec4(7.018336625601627,0.22037402844625237,5.219383369845124,1.0), vec4(0.0004151010351287002,0.05941859625259574,0.005231272155920089,0.0), 0.2 ),
Item(vec4(7.496084279423956,0.2,7.063824730785581,0.0), vec4(7.496084279423956,0.7512047549155061,7.063824730785581,1.0), vec4(0.30382668184146305,0.0050291311850023356,0.005644485684207782,0.0), 0.2 ),
Item(vec4(7.571843884206752,0.2,9.261739395377456,0.0), vec4(7.571843884206752,0.8353820935630571,9.261739395377456,1.0), vec4(0.4037104048205736,0.08457717418834107,0.6275566906210261,0.0), 0.2 ),
Item(vec4(9.443934938475124,0.2,-10.223615919998261,0.0), vec4(9.443934938475124,0.693261042750138,-10.223615919998261,1.0), vec4(0.2433064562949534,0.7441632588643775,0.023771347872937675,0.0), 0.2 ),
Item(vec4(9.451286627352024,0.2,-8.28451485562858,0.0), vec4(9.451286627352024,0.7014295859466932,-8.28451485562858,1.0), vec4(0.2514316296626723,0.6319987553286345,0.005945487330703746,0.0), 0.2 ),
Item(vec4(9.854305154075643,0.2,-6.844082102465557,0.0), vec4(9.854305154075643,0.2,-6.844082102465557,0.0), vec4(0.9746139744864681,0.5866210541858018,0.8881044914929678,0.09488863310208576), 0.2 ),
Item(vec4(9.886406284029665,0.2,-4.260604869730837,0.0), vec4(9.886406284029665,0.2,-4.260604869730837,0.0), vec4(1.5,1.5,1.5,1.5), 0.2 ),
Item(vec4(9.096189961123404,0.2,-2.537077574050276,0.0), vec4(9.096189961123404,0.3068777345815598,-2.537077574050276,1.0), vec4(0.011422850149286344,0.2645644104286148,0.8452171816748446,0.0), 0.2 ),
Item(vec4(9.264140544933602,0.2,-0.19561708207378914,0.0), vec4(9.264140544933602,0.49348949437066775,-0.19561708207378914,1.0), vec4(0.08613608330595021,0.7988047884586237,0.020073405741902917,0.0), 0.2 ),
Item(vec4(9.81943350695346,0.2,1.028583951307603,0.0), vec4(9.81943350695346,0.2,1.028583951307603,0.0), vec4(0.955240837196367,0.5158799729486683,0.6580343388804415,0.025562373489694964), 0.2 ),
Item(vec4(9.812779455342701,0.2,3.7234706528855748,0.0), vec4(9.812779455342701,0.2,3.7234706528855748,0.0), vec4(0.9515441418570563,0.9019281404919859,0.9535768834983986,0.40388957768214623), 0.2 ),
Item(vec4(9.756646670022064,0.2,5.67156639686407,0.0), vec4(9.756646670022064,0.2,5.67156639686407,0.0), vec4(0.9203592611233689,0.873092442702261,0.8447975896501323,0.3756305938482159), 0.2 ),
Item(vec4(9.160339379079891,0.2,7.389374200878613,0.0), vec4(9.160339379079891,0.3781548656443236,7.389374200878613,1.0), vec4(0.03173915615274699,0.1871756398887144,0.02493144484627296,0.0), 0.2 ),
Item(vec4(9.643342006771931,0.2,9.601000865716987,0.0), vec4(9.643342006771931,0.9148244519688113,9.601000865716987,1.0), vec4(0.5109739971325113,0.4459284451760109,0.06379989340221796,0.0), 0.2 )
);

#ifdef USE_BVH

#define NumNodes 249
BVH Nodes[NumNodes] = BVH[NumNodes](
BVH( vec3(-1000.0,-2000.0,-1001.0), vec3(1000.0,2.0,999.0), ivec2(1,124)),
BVH( vec3(-1000.0,-2000.0,-1001.0), vec3(1000.0,2.0,999.0), ivec2(2,63)),
BVH( vec3(-1000.0,-2000.0,-1001.0), vec3(1000.0,2.0,999.0), ivec2(3,32)),
BVH( vec3(-1000.0,-2000.0,-1001.0), vec3(1000.0,0.9699993338763802,999.0), ivec2(4,17)),
BVH( vec3(-1000.0,-2000.0,-1001.0), vec3(1000.0,0.9699993338763802,999.0), ivec2(5,10)),
BVH( vec3(-1000.0,-2000.0,-1001.0), vec3(1000.0,0.8596034657377336,999.0), ivec2(6,7)),
BVH( vec3(-1000.0,-2000.0,-1001.0), vec3(1000.0,0.0,999.0), ivec2(-1,0)),
BVH( vec3(-8.786356880836038,0.0,-11.149489032231333), vec3(-4.4165183882806645,0.8596034657377336,-10.539196546868563), ivec2(8,9)),
BVH( vec3(-4.816518388280665,0.0,-11.149489032231333), vec3(-4.4165183882806645,0.8260906796881502,-10.749489032231335), ivec2(-1,37)),
BVH( vec3(-8.786356880836038,0.0,-10.939196546868562), vec3(-8.38635688083604,0.8596034657377336,-10.539196546868563), ivec2(-1,15)),
BVH( vec3(-11.079072180298839,0.0,-10.725357640856787), vec3(-2.656337027775537,0.9699993338763802,-8.620144521840572), ivec2(11,14)),
BVH( vec3(-11.079072180298839,0.0,-10.499401646499868), vec3(-6.3424161605750164,0.9084264882499817,-10.037309636756492), ivec2(12,13)),
BVH( vec3(-11.079072180298839,0.0,-10.43730963675649), vec3(-10.67907218029884,0.5343642441124012,-10.037309636756492), ivec2(-1,4)),
BVH( vec3(-6.742416160575017,0.0,-10.499401646499868), vec3(-6.3424161605750164,0.9084264882499817,-10.099401646499869), ivec2(-1,26)),
BVH( vec3(-4.687000599511258,0.0,-10.725357640856787), vec3(-2.656337027775537,0.9699993338763802,-8.620144521840572), ivec2(15,16)),
BVH( vec3(-4.687000599511258,0.0,-9.020144521840571), vec3(-4.2870005995112574,0.9699993338763802,-8.620144521840572), ivec2(-1,38)),
BVH( vec3(-3.0563370277755375,0.0,-10.725357640856787), vec3(-2.656337027775537,0.5596255246938475,-10.325357640856788), ivec2(-1,48)),
BVH( vec3(-10.97043787683452,0.0,-8.931254645339287), vec3(-0.7470933954141579,0.8849251122277342,-6.166956120256548), ivec2(18,25)),
BVH( vec3(-10.97043787683452,0.0,-8.931254645339287), vec3(-0.7470933954141579,0.7932550949642261,-8.29919110961281), ivec2(19,22)),
BVH( vec3(-6.846070414532197,0.0,-8.931254645339287), vec3(-0.7470933954141579,0.7932550949642261,-8.359275831583968), ivec2(20,21)),
BVH( vec3(-1.1470933954141578,0.0,-8.931254645339287), vec3(-0.7470933954141579,0.4587851162064913,-8.531254645339288), ivec2(-1,60)),
BVH( vec3(-6.846070414532197,0.0,-8.759275831583967), vec3(-6.446070414532197,0.7932550949642261,-8.359275831583968), ivec2(-1,27)),
BVH( vec3(-10.97043787683452,0.0,-8.754108421617252), vec3(-8.046179821903685,0.6550690257394217,-8.29919110961281), ivec2(23,24)),
BVH( vec3(-10.97043787683452,0.0,-8.754108421617252), vec3(-10.570437876834522,0.6550690257394217,-8.354108421617253), ivec2(-1,5)),
BVH( vec3(-8.446179821903684,0.0,-8.699191109612809), vec3(-8.046179821903685,0.4,-8.29919110961281), ivec2(-1,16)),
BVH( vec3(-7.160861438679126,0.0,-8.559569065533253), vec3(-2.5101984102514066,0.8849251122277342,-6.166956120256548), ivec2(26,29)),
BVH( vec3(-7.160861438679126,0.0,-6.87888903190954), vec3(-4.363567398995039,0.8849251122277342,-6.166956120256548), ivec2(27,28)),
BVH( vec3(-4.76356739899504,0.0,-6.87888903190954), vec3(-4.363567398995039,0.8849251122277342,-6.47888903190954), ivec2(-1,39)),
BVH( vec3(-7.160861438679126,0.0,-6.566956120256548), vec3(-6.760861438679125,0.44348729035652745,-6.166956120256548), ivec2(-1,28)),
BVH( vec3(-2.9543770068631883,0.0,-8.559569065533253), vec3(-2.5101984102514066,0.7220017663873259,-6.373606087246749), ivec2(30,31)),
BVH( vec3(-2.9543770068631883,0.0,-8.559569065533253), vec3(-2.554377006863188,0.6729144368186801,-8.159569065533255), ivec2(-1,49)),
BVH( vec3(-2.910198410251407,0.0,-6.773606087246749), vec3(-2.5101984102514066,0.7220017663873259,-6.373606087246749), ivec2(-1,50)),
BVH( vec3(-11.174487271130193,0.0,-6.490148983978038), vec3(1.0,2.0,1.0), ivec2(33,48)),
BVH( vec3(-11.174487271130193,0.0,-6.490148983978038), vec3(-0.5206727353821794,1.0515929727227629,-3.9546404110782456), ivec2(34,41)),
BVH( vec3(-10.613566324549513,0.0,-6.490148983978038), vec3(-6.266134642657948,1.0515929727227629,-4.445760282259878), ivec2(35,38)),
BVH( vec3(-10.613566324549513,0.0,-6.490148983978038), vec3(-8.691199036174774,1.0515929727227629,-4.500574333175884), ivec2(36,37)),
BVH( vec3(-10.613566324549513,0.0,-6.490148983978038), vec3(-10.213566324549515,1.0515929727227629,-6.090148983978038), ivec2(-1,6)),
BVH( vec3(-9.091199036174773,0.0,-4.900574333175884), vec3(-8.691199036174774,0.5208899598058064,-4.500574333175884), ivec2(-1,18)),
BVH( vec3(-9.032684360694754,0.0,-6.306710929041541), vec3(-6.266134642657948,0.9931837303800575,-4.445760282259878), ivec2(39,40)),
BVH( vec3(-9.032684360694754,0.0,-6.306710929041541), vec3(-8.632684360694755,0.5859062658947177,-5.906710929041541), ivec2(-1,17)),
BVH( vec3(-6.666134642657949,0.0,-4.845760282259878), vec3(-6.266134642657948,0.9931837303800575,-4.445760282259878), ivec2(-1,29)),
BVH( vec3(-11.174487271130193,0.0,-4.821173188711832), vec3(-0.5206727353821794,0.9384787957378442,-3.9546404110782456), ivec2(42,45)),
BVH( vec3(-4.71536908383594,0.0,-4.821173188711832), vec3(-2.452098605714677,0.9384787957378442,-4.238859492482245), ivec2(43,44)),
BVH( vec3(-2.8520986057146773,0.0,-4.821173188711832), vec3(-2.452098605714677,0.7865571047614699,-4.4211731887118315), ivec2(-1,51)),
BVH( vec3(-4.71536908383594,0.0,-4.638859492482245), vec3(-4.3153690838359395,0.9384787957378442,-4.238859492482245), ivec2(-1,40)),
BVH( vec3(-11.174487271130193,0.0,-4.447811406472117), vec3(-0.5206727353821794,0.710363627353134,-3.9546404110782456), ivec2(46,47)),
BVH( vec3(-11.174487271130193,0.0,-4.447811406472117), vec3(-10.774487271130194,0.42834747652200633,-4.047811406472117), ivec2(-1,7)),
BVH( vec3(-0.9206727353821793,0.0,-4.354640411078246), vec3(-0.5206727353821794,0.710363627353134,-3.9546404110782456), ivec2(-1,62)),
BVH( vec3(-10.550613970893295,0.0,-3.1981045519840006), vec3(1.0,2.0,1.0), ivec2(49,56)),
BVH( vec3(-10.513947925787852,0.0,-3.1981045519840006), vec3(-2.7021144767991276,1.162280082457942,-1.9572034718804863), ivec2(50,53)),
BVH( vec3(-10.513947925787852,0.0,-3.1981045519840006), vec3(-8.15992740727425,1.162280082457942,-1.9572034718804863), ivec2(51,52)),
BVH( vec3(-10.513947925787852,0.0,-3.1981045519840006), vec3(-10.113947925787853,1.162280082457942,-2.798104551984), ivec2(-1,8)),
BVH( vec3(-8.559927407274248,0.0,-2.3572034718804864), vec3(-8.15992740727425,1.1111917696952796,-1.9572034718804863), ivec2(-1,19)),
BVH( vec3(-4.787667879910249,0.0,-3.174822514324542), vec3(-2.7021144767991276,0.8581468000997243,-1.9901633496795819), ivec2(54,55)),
BVH( vec3(-4.787667879910249,0.0,-3.174822514324542), vec3(-4.387667879910248,0.8581468000997243,-2.7748225143245415), ivec2(-1,41)),
BVH( vec3(-3.102114476799128,0.0,-2.390163349679582), vec3(-2.7021144767991276,0.5087616924454134,-1.9901633496795819), ivec2(-1,52)),
BVH( vec3(-10.550613970893295,0.0,-2.316131026215319), vec3(1.0,2.0,1.0), ivec2(57,60)),
BVH( vec3(-6.7479852974098655,0.0,-2.316131026215319), vec3(-3.0,2.0,1.0), ivec2(58,59)),
BVH( vec3(-6.7479852974098655,0.0,-2.316131026215319), vec3(-6.347985297409865,0.9022385584334831,-1.916131026215319), ivec2(-1,30)),
BVH( vec3(-5.0,0.0,-1.0), vec3(-3.0,2.0,1.0), ivec2(-1,2)),
BVH( vec3(-10.550613970893295,0.0,-1.0), vec3(1.0,2.0,1.0), ivec2(61,62)),
BVH( vec3(-1.0,0.0,-1.0), vec3(1.0,2.0,1.0), ivec2(-1,1)),
BVH( vec3(-10.550613970893295,0.0,-0.9941140008565925), vec3(-10.150613970893296,1.1215400323407825,-0.5941140008565926), ivec2(-1,9)),
BVH( vec3(-11.005060542582447,0.0,-0.6739852162994029), vec3(-0.6148144184347657,1.198438940577426,9.78365577628933), ivec2(64,93)),
BVH( vec3(-10.712728774485852,0.0,-0.6739852162994029), vec3(-2.153048074514389,1.198438940577426,5.205138216505354), ivec2(65,78)),
BVH( vec3(-10.388715288149664,0.0,-0.6739852162994029), vec3(-2.6118181067034065,1.198438940577426,1.9173878063719465), ivec2(66,71)),
BVH( vec3(-10.388715288149664,0.0,-0.5967249902273362), vec3(-6.314344296395199,0.9396174484497788,1.227530984730198), ivec2(67,68)),
BVH( vec3(-10.388715288149664,0.0,0.8275309847301981), vec3(-9.988715288149665,0.4,1.227530984730198), ivec2(-1,10)),
BVH( vec3(-8.452967876053105,0.0,-0.5967249902273362), vec3(-6.314344296395199,0.9396174484497788,-0.025739198971505395), ivec2(69,70)),
BVH( vec3(-8.452967876053105,0.0,-0.5967249902273362), vec3(-8.052967876053106,0.4,-0.19672499022733608), ivec2(-1,20)),
BVH( vec3(-6.7143442963952,0.0,-0.4257391989715054), vec3(-6.314344296395199,0.9396174484497788,-0.025739198971505395), ivec2(-1,31)),
BVH( vec3(-5.040509866955276,0.0,-0.6739852162994029), vec3(-2.6118181067034065,1.198438940577426,1.9173878063719465), ivec2(72,75)),
BVH( vec3(-5.040509866955276,0.0,-0.6739852162994029), vec3(-4.081404953480316,1.198438940577426,1.9173878063719465), ivec2(73,74)),
BVH( vec3(-5.040509866955276,0.0,-0.6739852162994029), vec3(-4.640509866955275,0.5772112589385827,-0.2739852162994028), ivec2(-1,42)),
BVH( vec3(-4.481404953480316,0.0,1.5173878063719466), vec3(-4.081404953480316,1.198438940577426,1.9173878063719465), ivec2(-1,43)),
BVH( vec3(-3.1812637023416417,0.0,-0.6549162239693851), vec3(-2.6118181067034065,0.6090909925517701,1.2160780687450157), ivec2(76,77)),
BVH( vec3(-3.1812637023416417,0.0,0.8160780687450158), vec3(-2.7812637023416413,0.42081810850928736,1.2160780687450157), ivec2(-1,54)),
BVH( vec3(-3.011818106703407,0.0,-0.6549162239693851), vec3(-2.6118181067034065,0.6090909925517701,-0.2549162239693851), ivec2(-1,53)),
BVH( vec3(-10.712728774485852,0.0,1.594231100748672), vec3(-2.153048074514389,1.1188354727617897,5.205138216505354), ivec2(79,86)),
BVH( vec3(-8.671177454470795,0.0,1.594231100748672), vec3(-2.153048074514389,1.1188354727617897,3.4423515296972793), ivec2(80,83)),
BVH( vec3(-8.671177454470795,0.0,1.594231100748672), vec3(-6.337605503131127,0.9875806061435595,2.057220649441443), ivec2(81,82)),
BVH( vec3(-8.671177454470795,0.0,1.594231100748672), vec3(-8.271177454470797,0.9875806061435595,1.994231100748672), ivec2(-1,21)),
BVH( vec3(-6.737605503131127,0.0,1.6572206494414428), vec3(-6.337605503131127,0.9137716631876369,2.057220649441443), ivec2(-1,32)),
BVH( vec3(-6.786781441280398,0.0,2.944204833366734), vec3(-2.153048074514389,1.1188354727617897,3.4423515296972793), ivec2(84,85)),
BVH( vec3(-2.5530480745143893,0.0,2.944204833366734), vec3(-2.153048074514389,1.1188354727617897,3.3442048333667342), ivec2(-1,55)),
BVH( vec3(-6.786781441280398,0.0,3.042351529697279), vec3(-6.386781441280398,0.8591317319106684,3.4423515296972793), ivec2(-1,33)),
BVH( vec3(-10.712728774485852,0.0,3.3301020321842962), vec3(-4.570235363921425,0.9414124727934965,5.205138216505354), ivec2(87,90)),
BVH( vec3(-10.712728774485852,0.0,3.3301020321842962), vec3(-8.34524456147836,0.9414124727934965,4.04523424650066), ivec2(88,89)),
BVH( vec3(-10.712728774485852,0.0,3.6452342465006593), vec3(-10.312728774485853,0.9414124727934965,4.04523424650066), ivec2(-1,11)),
BVH( vec3(-8.745244561478358,0.0,3.3301020321842962), vec3(-8.34524456147836,0.9052838205796003,3.7301020321842966), ivec2(-1,22)),
BVH( vec3(-6.338595346685796,0.0,3.5575703490466863), vec3(-4.570235363921425,0.655294040087306,5.205138216505354), ivec2(91,92)),
BVH( vec3(-4.970235363921425,0.0,3.5575703490466863), vec3(-4.570235363921425,0.655294040087306,3.9575703490466867), ivec2(-1,44)),
BVH( vec3(-6.338595346685796,0.0,4.8051382165053536), vec3(-5.938595346685796,0.4,5.205138216505354), ivec2(-1,34)),
BVH( vec3(-11.005060542582447,0.0,4.8150215671040035), vec3(-0.6148144184347657,1.1555867752521982,9.78365577628933), ivec2(94,109)),
BVH( vec3(-11.005060542582447,0.0,5.179904918024445), vec3(-6.061562679267066,1.0744858305023273,9.666810455170701), ivec2(95,102)),
BVH( vec3(-11.005060542582447,0.0,5.179904918024445), vec3(-8.644293338578855,0.6330844502575727,9.407779887386885), ivec2(96,99)),
BVH( vec3(-11.005060542582447,0.0,5.179904918024445), vec3(-10.60047750035427,0.6216916662730351,7.594098834285515), ivec2(97,98)),
BVH( vec3(-11.005060542582447,0.0,5.179904918024445), vec3(-10.605060542582448,0.6165993971306134,5.579904918024446), ivec2(-1,12)),
BVH( vec3(-11.000477500354268,0.0,7.194098834285515), vec3(-10.60047750035427,0.6216916662730351,7.594098834285515), ivec2(-1,13)),
BVH( vec3(-10.990223994768185,0.0,7.2939188852493375), vec3(-8.644293338578855,0.6330844502575727,9.407779887386885), ivec2(100,101)),
BVH( vec3(-10.990223994768185,0.0,9.007779887386887), vec3(-10.590223994768186,0.6330844502575727,9.407779887386885), ivec2(-1,14)),
BVH( vec3(-9.044293338578854,0.0,7.2939188852493375), vec3(-8.644293338578855,0.573007401579051,7.693918885249338), ivec2(-1,24)),
BVH( vec3(-8.981534023811239,0.0,5.517663822798872), vec3(-6.061562679267066,1.0744858305023273,9.666810455170701), ivec2(103,106)),
BVH( vec3(-8.981534023811239,0.0,5.517663822798872), vec3(-8.192962752547906,1.0744858305023273,9.537232718451476), ivec2(104,105)),
BVH( vec3(-8.981534023811239,0.0,5.517663822798872), vec3(-8.58153402381124,0.6427399735430677,5.917663822798873), ivec2(-1,23)),
BVH( vec3(-8.592962752547905,0.0,9.137232718451477), vec3(-8.192962752547906,1.0744858305023273,9.537232718451476), ivec2(-1,25)),
BVH( vec3(-6.471774089214769,0.0,7.597561622743407), vec3(-6.061562679267066,0.4,9.666810455170701), ivec2(107,108)),
BVH( vec3(-6.471774089214769,0.0,9.266810455170702), vec3(-6.0717740892147685,0.4,9.666810455170701), ivec2(-1,36)),
BVH( vec3(-6.461562679267066,0.0,7.597561622743407), vec3(-6.061562679267066,0.4,7.997561622743407), ivec2(-1,35)),
BVH( vec3(-5.125089275976492,0.0,4.8150215671040035), vec3(-0.6148144184347657,1.1555867752521982,9.78365577628933), ivec2(110,117)),
BVH( vec3(-5.125089275976492,0.0,4.8150215671040035), vec3(-0.6148144184347657,1.1555867752521982,7.806737712822178), ivec2(111,114)),
BVH( vec3(-5.125089275976492,0.0,4.8150215671040035), vec3(-2.189641784250747,1.0781757952769475,5.690231947221014), ivec2(112,113)),
BVH( vec3(-5.125089275976492,0.0,4.8150215671040035), vec3(-4.725089275976492,0.4832341378038979,5.215021567104004), ivec2(-1,45)),
BVH( vec3(-2.5896417842507473,0.0,5.290231947221014), vec3(-2.189641784250747,1.0781757952769475,5.690231947221014), ivec2(-1,56)),
BVH( vec3(-4.519971902273022,0.0,7.024603303088081), vec3(-0.6148144184347657,1.1555867752521982,7.806737712822178), ivec2(115,116)),
BVH( vec3(-4.519971902273022,0.0,7.024603303088081), vec3(-4.119971902273021,1.1555867752521982,7.424603303088081), ivec2(-1,46)),
BVH( vec3(-1.0148144184347658,0.0,7.406737712822178), vec3(-0.6148144184347657,0.6057617572947047,7.806737712822178), ivec2(-1,68)),
BVH( vec3(-4.637678124262772,0.0,7.518029771935535), vec3(-0.6252932195133294,1.0248020841524763,9.78365577628933), ivec2(118,121)),
BVH( vec3(-2.3219649339639052,0.0,7.518029771935535), vec3(-0.6252932195133294,0.5941186449851896,9.293981800557363), ivec2(119,120)),
BVH( vec3(-2.3219649339639052,0.0,7.518029771935535), vec3(-1.921964933963905,0.4,7.918029771935536), ivec2(-1,57)),
BVH( vec3(-1.0252932195133293,0.0,8.893981800557365), vec3(-0.6252932195133294,0.5941186449851896,9.293981800557363), ivec2(-1,69)),
BVH( vec3(-4.637678124262772,0.0,9.109980577686846), vec3(-2.599123797777996,1.0248020841524763,9.78365577628933), ivec2(122,123)),
BVH( vec3(-4.637678124262772,0.0,9.109980577686846), vec3(-4.2376781242627715,1.0248020841524763,9.509980577686845), ivec2(-1,47)),
BVH( vec3(-2.9991237977779965,0.0,9.38365577628933), vec3(-2.599123797777996,0.6231957802466708,9.78365577628933), ivec2(-1,58)),
BVH( vec3(-0.8254449635114771,0.0,-10.96682260733172), vec3(10.086406284029664,2.0,9.801000865716986), ivec2(125,186)),
BVH( vec3(-0.8254449635114771,0.0,-10.96682260733172), vec3(10.086406284029664,2.0,1.0), ivec2(126,155)),
BVH( vec3(-0.8254449635114771,0.0,-10.910878771589386), vec3(5.0,2.0,1.0), ivec2(127,140)),
BVH( vec3(-0.8254449635114771,0.0,-10.910878771589386), vec3(1.807009562751387,1.0744550697237631,-0.7658751224612774), ivec2(128,133)),
BVH( vec3(-0.8254449635114771,0.0,-10.910878771589386), vec3(-0.012019180188356626,0.9758459627880567,-2.572877707948148), ivec2(129,130)),
BVH( vec3(-0.8254449635114771,0.0,-2.9728777079481485), vec3(-0.42544496351147704,0.8161722627650254,-2.572877707948148), ivec2(-1,63)),
BVH( vec3(-0.6817386334907489,0.0,-10.910878771589386), vec3(-0.012019180188356626,0.9758459627880567,-6.524252041700079), ivec2(131,132)),
BVH( vec3(-0.6817386334907489,0.0,-10.910878771589386), vec3(-0.28173863349074896,0.9758459627880567,-10.510878771589388), ivec2(-1,59)),
BVH( vec3(-0.41201918018835665,0.0,-6.924252041700079), vec3(-0.012019180188356626,0.4,-6.524252041700079), ivec2(-1,61)),
BVH( vec3(-0.409153891612038,0.0,-10.750180069986877), vec3(1.807009562751387,1.0744550697237631,-0.7658751224612774), ivec2(134,137)),
BVH( vec3(-0.409153891612038,0.0,-6.9050333654133595), vec3(1.3807677102966833,0.6008530114407594,-0.7658751224612774), ivec2(135,136)),
BVH( vec3(-0.409153891612038,0.0,-1.1658751224612776), vec3(-0.009153891612038001,0.4,-0.7658751224612774), ivec2(-1,64)),
BVH( vec3(0.9807677102966834,0.0,-6.9050333654133595), vec3(1.3807677102966833,0.6008530114407594,-6.505033365413359), ivec2(-1,72)),
BVH( vec3(1.0664654057748364,0.0,-10.750180069986877), vec3(1.807009562751387,1.0744550697237631,-2.046069036861432), ivec2(138,139)),
BVH( vec3(1.0664654057748364,0.0,-10.750180069986877), vec3(1.4664654057748363,0.6960726730831516,-10.350180069986878), ivec2(-1,70)),
BVH( vec3(1.407009562751387,0.0,-2.446069036861432), vec3(1.807009562751387,1.0744550697237631,-2.046069036861432), ivec2(-1,74)),
BVH( vec3(1.5044303381564381,0.0,-10.341123288545027), vec3(5.0,2.0,1.0), ivec2(141,148)),
BVH( vec3(1.5844593566811997,0.0,-10.341123288545027), vec3(3.74358427600254,1.0039825288917112,-6.734125923050886), ivec2(142,145)),
BVH( vec3(2.9218113796559075,0.0,-10.341123288545027), vec3(3.74358427600254,1.0039825288917112,-8.303946573337706), ivec2(143,144)),
BVH( vec3(3.34358427600254,0.0,-10.341123288545027), vec3(3.74358427600254,1.0039825288917112,-9.941123288545029), ivec2(-1,81)),
BVH( vec3(2.9218113796559075,0.0,-8.703946573337705), vec3(3.321811379655908,0.535345977395453,-8.303946573337706), ivec2(-1,82)),
BVH( vec3(1.5844593566811997,0.0,-8.390289557328696), vec3(3.23522401873722,0.4391377985969106,-6.734125923050886), ivec2(146,147)),
BVH( vec3(1.5844593566811997,0.0,-8.390289557328696), vec3(1.9844593566811997,0.4,-7.990289557328697), ivec2(-1,71)),
BVH( vec3(2.8352240187372195,0.0,-7.134125923050886), vec3(3.23522401873722,0.4391377985969106,-6.734125923050886), ivec2(-1,83)),
BVH( vec3(1.5044303381564381,0.0,-4.89481391693416), vec3(5.0,2.0,1.0), ivec2(149,152)),
BVH( vec3(1.5044303381564381,0.0,-4.89481391693416), vec3(3.909304803852704,1.1881164487252263,-4.054344625677798), ivec2(150,151)),
BVH( vec3(1.5044303381564381,0.0,-4.89481391693416), vec3(1.904430338156438,1.1827003757293755,-4.494813916934159), ivec2(-1,73)),
BVH( vec3(3.5093048038527037,0.0,-4.454344625677798), vec3(3.909304803852704,1.1881164487252263,-4.054344625677798), ivec2(-1,84)),
BVH( vec3(3.0,0.0,-2.4962867585305206), vec3(5.0,2.0,1.0), ivec2(153,154)),
BVH( vec3(3.0,0.0,-1.0), vec3(5.0,2.0,1.0), ivec2(-1,3)),
BVH( vec3(3.3536674293031328,0.0,-2.4962867585305206), vec3(3.753667429303133,1.0151860325590365,-2.0962867585305203), ivec2(-1,85)),
BVH( vec3(4.892550731387678,0.0,-10.96682260733172), vec3(10.086406284029664,1.0618344288753492,-0.764341807927666), ivec2(156,171)),
BVH( vec3(4.892550731387678,0.0,-10.96682260733172), vec3(10.054305154075642,1.0618344288753492,-5.9803120235486), ivec2(157,164)),
BVH( vec3(4.892550731387678,0.0,-10.821087771312758), vec3(7.476589006031262,0.7073211178125134,-5.9803120235486), ivec2(158,161)),
BVH( vec3(4.892550731387678,0.0,-8.98272174341194), vec3(5.350645093715198,0.5673834374613318,-5.9803120235486), ivec2(159,160)),
BVH( vec3(4.950645093715198,0.0,-8.98272174341194), vec3(5.350645093715198,0.5673834374613318,-8.582721743411941), ivec2(-1,93)),
BVH( vec3(4.892550731387678,0.0,-6.3803120235486), vec3(5.292550731387679,0.5028341459863098,-5.9803120235486), ivec2(-1,94)),
BVH( vec3(5.68934264874543,0.0,-10.821087771312758), vec3(7.476589006031262,0.7073211178125134,-8.578256923523417), ivec2(162,163)),
BVH( vec3(5.68934264874543,0.0,-10.821087771312758), vec3(6.08934264874543,0.4,-10.42108777131276), ivec2(-1,92)),
BVH( vec3(7.076589006031262,0.0,-8.978256923523416), vec3(7.476589006031262,0.7073211178125134,-8.578256923523417), ivec2(-1,104)),
BVH( vec3(7.395650985987814,0.0,-10.96682260733172), vec3(10.054305154075642,1.0618344288753492,-6.644082102465557), ivec2(165,168)),
BVH( vec3(7.395650985987814,0.0,-10.96682260733172), vec3(9.643934938475123,1.0618344288753492,-10.023615919998262), ivec2(166,167)),
BVH( vec3(7.395650985987814,0.0,-10.96682260733172), vec3(7.795650985987814,1.0618344288753492,-10.566822607331721), ivec2(-1,103)),
BVH( vec3(9.243934938475125,0.0,-10.42361591999826), vec3(9.643934938475123,0.893261042750138,-10.023615919998262), ivec2(-1,114)),
BVH( vec3(9.251286627352025,0.0,-8.484514855628579), vec3(10.054305154075642,0.9014295859466932,-6.644082102465557), ivec2(169,170)),
BVH( vec3(9.251286627352025,0.0,-8.484514855628579), vec3(9.651286627352023,0.9014295859466932,-8.08451485562858), ivec2(-1,115)),
BVH( vec3(9.654305154075644,0.0,-7.044082102465557), vec3(10.054305154075642,0.4,-6.644082102465557), ivec2(-1,116)),
BVH( vec3(5.028069122437014,0.0,-6.314960954502538), vec3(10.086406284029664,1.0520501994894171,-0.764341807927666), ivec2(172,179)),
BVH( vec3(5.67323763287539,0.0,-6.314960954502538), vec3(10.086406284029664,1.0520105345126705,-3.9816995446643597), ivec2(173,176)),
BVH( vec3(7.052708051208207,0.0,-6.314960954502538), vec3(7.786809481061404,1.0520105345126705,-4.220880527757142), ivec2(174,175)),
BVH( vec3(7.052708051208207,0.0,-6.314960954502538), vec3(7.452708051208208,0.6807867235646755,-5.914960954502537), ivec2(-1,105)),
BVH( vec3(7.386809481061404,0.0,-4.6208805277571425), vec3(7.786809481061404,1.0520105345126705,-4.220880527757142), ivec2(-1,106)),
BVH( vec3(5.67323763287539,0.0,-4.460604869730838), vec3(10.086406284029664,0.4,-3.9816995446643597), ivec2(177,178)),
BVH( vec3(9.686406284029665,0.0,-4.460604869730838), vec3(10.086406284029664,0.4,-4.060604869730837), ivec2(-1,117)),
BVH( vec3(5.67323763287539,0.0,-4.38169954466436), vec3(6.07323763287539,0.4,-3.9816995446643597), ivec2(-1,95)),
BVH( vec3(5.028069122437014,0.0,-2.923894134633638), vec3(9.296189961123403,1.0520501994894171,-0.764341807927666), ivec2(180,183)),
BVH( vec3(5.028069122437014,0.0,-2.770690913624959), vec3(5.786845179540475,1.0520501994894171,-0.764341807927666), ivec2(181,182)),
BVH( vec3(5.028069122437014,0.0,-2.770690913624959), vec3(5.428069122437014,0.6534101360411267,-2.3706909136249585), ivec2(-1,96)),
BVH( vec3(5.386845179540475,0.0,-1.164341807927666), vec3(5.786845179540475,1.0520501994894171,-0.764341807927666), ivec2(-1,97)),
BVH( vec3(7.151430696025031,0.0,-2.923894134633638), vec3(9.296189961123403,0.7904785511389232,-2.3370775740502756), ivec2(184,185)),
BVH( vec3(7.151430696025031,0.0,-2.923894134633638), vec3(7.551430696025031,0.7904785511389232,-2.5238941346336374), ivec2(-1,107)),
BVH( vec3(8.896189961123405,0.0,-2.737077574050276), vec3(9.296189961123403,0.5068777345815598,-2.3370775740502756), ivec2(-1,118)),
BVH( vec3(-0.7420136285298986,0.0,-0.9986573345261076), vec3(10.01943350695346,1.1870146635603287,9.801000865716986), ivec2(187,218)),
BVH( vec3(-0.7420136285298986,0.0,-0.9986573345261076), vec3(5.300226079114203,1.1870146635603287,9.46209375867002), ivec2(188,203)),
BVH( vec3(-0.7420136285298986,0.0,-0.4058461177801828), vec3(1.8529186676171452,1.1254651862412723,9.46209375867002), ivec2(189,196)),
BVH( vec3(-0.3340189873372638,0.0,-0.4058461177801828), vec3(1.8529186676171452,1.1254651862412723,3.276212207374836), ivec2(190,193)),
BVH( vec3(-0.3340189873372638,0.0,-0.4058461177801828), vec3(1.5094648333117378,0.7438498147908197,1.7132525132206622), ivec2(191,192)),
BVH( vec3(-0.3340189873372638,0.0,1.3132525132206623), vec3(0.0659810126627362,0.4,1.7132525132206622), ivec2(-1,65)),
BVH( vec3(1.1094648333117378,0.0,-0.4058461177801828), vec3(1.5094648333117378,0.7438498147908197,-0.005846117780182791), ivec2(-1,75)),
BVH( vec3(1.2360488503512446,0.0,1.686957406843218), vec3(1.8529186676171452,1.1254651862412723,3.276212207374836), ivec2(194,195)),
BVH( vec3(1.2360488503512446,0.0,1.686957406843218), vec3(1.6360488503512445,0.8844987226124941,2.086957406843218), ivec2(-1,76)),
BVH( vec3(1.4529186676171453,0.0,2.8762122073748357), vec3(1.8529186676171452,1.1254651862412723,3.276212207374836), ivec2(-1,77)),
BVH( vec3(-0.7420136285298986,0.0,3.6763977125437224), vec3(1.7401879471190245,1.0002088301322496,9.46209375867002), ivec2(197,200)),
BVH( vec3(-0.7420136285298986,0.0,3.6763977125437224), vec3(-0.018997042008505993,0.9088737460778904,5.540171950909247), ivec2(198,199)),
BVH( vec3(-0.7420136285298986,0.0,5.140171950909247), vec3(-0.34201362852989853,0.9088737460778904,5.540171950909247), ivec2(-1,67)),
BVH( vec3(-0.418997042008506,0.0,3.6763977125437224), vec3(-0.018997042008505993,0.4,4.076397712543723), ivec2(-1,66)),
BVH( vec3(1.1062567115017894,0.0,7.55701897613527), vec3(1.7401879471190245,1.0002088301322496,9.46209375867002), ivec2(201,202)),
BVH( vec3(1.3401879471190246,0.0,7.55701897613527), vec3(1.7401879471190245,1.0002088301322496,7.95701897613527), ivec2(-1,79)),
BVH( vec3(1.1062567115017894,0.0,9.062093758670022), vec3(1.5062567115017893,0.740285235001988,9.46209375867002), ivec2(-1,80)),
BVH( vec3(1.6198890051572612,0.0,-0.9986573345261076), vec3(5.300226079114203,1.1870146635603287,9.236021183201148), ivec2(204,211)),
BVH( vec3(1.6198890051572612,0.0,-0.9986573345261076), vec3(4.032560481897626,0.9707815255990233,5.391671375492282), ivec2(205,208)),
BVH( vec3(3.0400512786835625,0.0,-0.9986573345261076), vec3(3.713703373039121,0.9707815255990233,2.001691315069775), ivec2(206,207)),
BVH( vec3(3.3137033730391208,0.0,-0.9986573345261076), vec3(3.713703373039121,0.9707815255990233,-0.5986573345261077), ivec2(-1,86)),
BVH( vec3(3.0400512786835625,0.0,1.601691315069775), vec3(3.440051278683563,0.6667236429817364,2.001691315069775), ivec2(-1,87)),
BVH( vec3(1.6198890051572612,0.0,3.2119923331371205), vec3(4.032560481897626,0.4,5.391671375492282), ivec2(209,210)),
BVH( vec3(1.6198890051572612,0.0,4.991671375492282), vec3(2.0198890051572613,0.4,5.391671375492282), ivec2(-1,78)),
BVH( vec3(3.6325604818976256,0.0,3.2119923331371205), vec3(4.032560481897626,0.4,3.611992333137121), ivec2(-1,88)),
BVH( vec3(3.4033704751215375,0.0,5.544991340981157), vec3(5.300226079114203,1.1870146635603287,9.236021183201148), ivec2(212,215)),
BVH( vec3(3.4033704751215375,0.0,5.544991340981157), vec3(3.908313197204296,1.1870146635603287,7.282514810354866), ivec2(213,214)),
BVH( vec3(3.508313197204296,0.0,5.544991340981157), vec3(3.908313197204296,1.1870146635603287,5.944991340981157), ivec2(-1,89)),
BVH( vec3(3.4033704751215375,0.0,6.8825148103548655), vec3(3.803370475121538,1.0704116390239309,7.282514810354866), ivec2(-1,90)),
BVH( vec3(3.596554063341695,0.0,6.993673943032489), vec3(5.300226079114203,0.5113623101268919,9.236021183201148), ivec2(216,217)),
BVH( vec3(4.900226079114202,0.0,6.993673943032489), vec3(5.300226079114203,0.5113623101268919,7.393673943032489), ivec2(-1,101)),
BVH( vec3(3.596554063341695,0.0,8.836021183201149), vec3(3.996554063341695,0.4,9.236021183201148), ivec2(-1,91)),
BVH( vec3(5.204860081167088,0.0,-0.4375787107564065), vec3(10.01943350695346,1.1148244519688113,9.801000865716986), ivec2(219,234)),
BVH( vec3(5.204860081167088,0.0,-0.4375787107564065), vec3(10.01943350695346,0.9789854363170838,3.923470652885575), ivec2(220,227)),
BVH( vec3(5.684325263895417,0.0,-0.4375787107564065), vec3(10.01943350695346,0.716735146885602,1.465994874044026), ivec2(221,224)),
BVH( vec3(7.085061632197042,0.0,-0.4375787107564065), vec3(9.464140544933601,0.716735146885602,0.004382917926210872), ivec2(222,223)),
BVH( vec3(7.085061632197042,0.0,-0.4375787107564065), vec3(7.485061632197042,0.716735146885602,-0.03757871075640645), ivec2(-1,108)),
BVH( vec3(9.064140544933602,0.0,-0.39561708207378915), vec3(9.464140544933601,0.6934894943706678,0.004382917926210872), ivec2(-1,119)),
BVH( vec3(5.684325263895417,0.0,0.828583951307603), vec3(10.01943350695346,0.4,1.465994874044026), ivec2(225,226)),
BVH( vec3(9.619433506953461,0.0,0.828583951307603), vec3(10.01943350695346,0.4,1.228583951307603), ivec2(-1,120)),
BVH( vec3(5.684325263895417,0.0,1.0659948740440262), vec3(6.084325263895417,0.4,1.465994874044026), ivec2(-1,98)),
BVH( vec3(5.204860081167088,0.0,1.1009000650856857), vec3(10.0127794553427,0.9789854363170838,3.923470652885575), ivec2(228,231)),
BVH( vec3(5.204860081167088,0.0,1.1009000650856857), vec3(7.472528396705265,0.8498445346300978,3.481952774962035), ivec2(229,230)),
BVH( vec3(5.204860081167088,0.0,3.081952774962035), vec3(5.604860081167089,0.8498445346300978,3.481952774962035), ivec2(-1,99)),
BVH( vec3(7.072528396705264,0.0,1.1009000650856857), vec3(7.472528396705265,0.7028093296725162,1.5009000650856856), ivec2(-1,109)),
BVH( vec3(7.321086892685376,0.0,3.336366286000904), vec3(10.0127794553427,0.9789854363170838,3.923470652885575), ivec2(232,233)),
BVH( vec3(7.321086892685376,0.0,3.336366286000904), vec3(7.721086892685376,0.9789854363170838,3.736366286000904), ivec2(-1,110)),
BVH( vec3(9.612779455342702,0.0,3.5234706528855746), vec3(10.0127794553427,0.4,3.923470652885575), ivec2(-1,121)),
BVH( vec3(5.622052815449346,0.0,5.019383369845124), vec3(9.956646670022064,1.1148244519688113,9.801000865716986), ivec2(235,242)),
BVH( vec3(5.622052815449346,0.0,5.019383369845124), vec3(9.956646670022064,0.951204754915506,7.263824730785581), ivec2(236,239)),
BVH( vec3(6.818336625601627,0.0,5.019383369845124), vec3(9.956646670022064,0.4203740284462524,5.87156639686407), ivec2(237,238)),
BVH( vec3(6.818336625601627,0.0,5.019383369845124), vec3(7.218336625601627,0.4203740284462524,5.419383369845124), ivec2(-1,111)),
BVH( vec3(9.556646670022065,0.0,5.47156639686407), vec3(9.956646670022064,0.4,5.87156639686407), ivec2(-1,122)),
BVH( vec3(5.622052815449346,0.0,5.672831949154304), vec3(7.696084279423956,0.951204754915506,7.263824730785581), ivec2(240,241)),
BVH( vec3(5.622052815449346,0.0,5.672831949154304), vec3(6.022052815449347,0.4,6.072831949154304), ivec2(-1,100)),
BVH( vec3(7.2960842794239555,0.0,6.863824730785581), vec3(7.696084279423956,0.951204754915506,7.263824730785581), ivec2(-1,112)),
BVH( vec3(5.681957597301069,0.0,7.189374200878613), vec3(9.84334200677193,1.1148244519688113,9.801000865716986), ivec2(243,246)),
BVH( vec3(7.3718438842067515,0.0,7.189374200878613), vec3(9.36033937907989,1.035382093563057,9.461739395377455), ivec2(244,245)),
BVH( vec3(8.960339379079892,0.0,7.189374200878613), vec3(9.36033937907989,0.5781548656443236,7.589374200878614), ivec2(-1,123)),
BVH( vec3(7.3718438842067515,0.0,9.061739395377456), vec3(7.771843884206752,1.035382093563057,9.461739395377455), ivec2(-1,113)),
BVH( vec3(5.681957597301069,0.0,9.288621877736245), vec3(9.84334200677193,1.1148244519688113,9.801000865716986), ivec2(247,248)),
BVH( vec3(5.681957597301069,0.0,9.288621877736245), vec3(6.081957597301069,0.4,9.688621877736244), ivec2(-1,102)),
BVH( vec3(9.443342006771932,0.0,9.401000865716988), vec3(9.84334200677193,1.1148244519688113,9.801000865716986), ivec2(-1,124))
);
#endif

struct Ray {
    vec4 origin; // origin xyz + time as w
    vec3 direction;
};

struct Hit {
    Item item;
    vec3 position;
    vec3 normal;
//    vec2 uv;
    float t;
    bool frontFace;
};

vec3 rayAt(const Ray ray, const float t) {
    return ray.origin.xyz + t * ray.direction;
}

vec3 getItemCenter(const Item item, const float time)
{
    float ratio = (time-item.center0.w)/(item.center1.w-item.center0.w);
    return mix(item.center0.xyz, item.center1.xyz, ratio);
}

vec3 randomUnitSphere() {
    vec3 p = vec3(
        random(-1.0,1.0),
        random(-1.0,1.0),
        random(-1.0,1.0));
    float l = dot(p,p);
    if ( l <= 1.0) {
        return p;
    }
    return p*(1.0/l);
}

vec3 randomUnitDisk() {
    vec3 p = vec3(random(-1.0,1.0), random(-1.0,1.0), 0.0);
    float l = dot(p,p);
    if ( l <= 1.0) {
        return p;
    }
    return p*(1.0/l);
}

vec3 rayBackgroundColor(const Ray r) {
    const vec3 sky = vec3(0.5, 0.7, 1.0);
    const vec3 ground = vec3(1.0, 1.0, 1.0);
    float t = 0.5*(r.direction.y + 1.0);
    return mix(ground, sky, t);
}

bool _intersectAABBSlowest(const Ray r, const vec3 boxMin, const vec3 boxMax, float t_min, float t_max) {
    vec3 invD = vec3(1.0) / r.direction;
    vec3 tMin = (boxMin - r.origin.xyz) * invD;
    vec3 tMax = (boxMax - r.origin.xyz) * invD;
    vec3 t1 = max(min(tMin, tMax), vec3(t_min));
    vec3 t2 = min(max(tMin, tMax), vec3(t_max));
    if (t2[0] <= t1[0]) {
        return false;
    }
    if (t2[1] <= t1[1]) {
        return false;
    }
    if (t2[2] <= t1[2]) {
        return false;
    }
    return true;
    // float tNear = max(max(t1.x, t1.y), t1.z);
    // float tFar = min(min(t2.x, t2.y), t2.z);
    // return tFar <= tNear;
    //return vec2(tNear, tFar);
}

bool _intersectAABB(const Ray r, const vec3 aabbMin, const vec3 aabbMax, float t_min, float t_max) {

    int a;
    for (a = 0; a < 3; a++) {

        float invD = 1.0 / r.direction[a]; 
        float t0 = (aabbMin[a] - r.origin[a]) * invD;
        float t1 = (aabbMax[a] - r.origin[a]) * invD;

        float v0;
        float v1;
        if (invD < 0.0) {
            v0 = t1;
            v1 = t0;
        } else {
            v0 = t0;
            v1 = t1;
        }
        t_min = max(v0, t_min);
        t_max = min(v1, t_max);
        if (t_max <= t_min) {
            return false;
        }
    }
    return true;
}

bool _intersectSphere(const Ray ray, const float t_min, const float t_max, const vec4 sphere, inout Hit hit) {
    vec3 oc = ray.origin.xyz - sphere.xyz;
    float a = dot(ray.direction, ray.direction);
    float b = 2.0 * dot(oc, ray.direction);
    float c = dot(oc, oc) - sphere.w*sphere.w;
    float discriminant = b*b - 4.0*a*c;
    if (discriminant < 0.0) {
        return false;
    }

    float sqrtd = sqrt(discriminant);

    float root = (-b - sqrtd ) / (2.0*a);
    if ( root < t_min || t_max < root ) {
        root = (-b + sqrtd ) / (2.0*a);
        if (root < t_min || t_max < root)
            return false;
    }

    hit.t = root;
    hit.position = rayAt(ray, hit.t);
    hit.normal = (hit.position - sphere.xyz) / sphere.w;

    bool front_face = dot(ray.direction, hit.normal) < 0.0;
    hit.normal = front_face ? hit.normal :-hit.normal;
    hit.frontFace = front_face;
    return true;
}

bool intersectSphere(const Ray ray, const float t_min, const float t_max, const Item item, inout Hit hit) {
    float time = ray.origin.w;
    vec4 sphere = vec4(getItemCenter(item, time), item.radius);
    return _intersectSphere(ray, t_min, t_max, sphere, hit);
}

#define MaxStackSize 50
int NodeStack[MaxStackSize];

bool intersectWorld(const Ray ray, float min_t, float max_t, out Hit hit)
{
    bool rayHit = false;

#ifndef USE_BVH
    int i;
    for ( i = 0 ; i < NumItems; i++) {
        bool intersect = intersectSphere(ray, min_t, max_t, Items[i], hit);
        if (intersect) {
            hit.item = Items[i];
            max_t = hit.t;
            rayHit = true;
        }
    }
#else
    // I am old and I dont remember how to translate recursion tree to linear preorder traversal
    // https://www.geeksforgeeks.org/iterative-preorder-traversal/
    int i;
    int stackIndex = 0;
    NodeStack[stackIndex++] = 0;

    while (stackIndex !=0 ) {
    // for (i = 0; i < MaxStackSize; i++) {
        if (stackIndex == 0) {
            break;
        }
        int currentNode = NodeStack[--stackIndex];

        // do something with the node
        if (!_intersectAABB(ray, Nodes[currentNode].min, Nodes[currentNode].max, min_t, max_t)) {
            continue;
        }

        int left = Nodes[currentNode].nodes[0];
        int right = Nodes[currentNode].nodes[1];

        if (left == -1) {
            bool intersect = intersectSphere(ray, min_t, max_t, Items[right], hit);
            if (intersect) {
                hit.item = Items[right];
                max_t = hit.t;
                rayHit = true;
            }
        } else {
            NodeStack[stackIndex++] = right;
            NodeStack[stackIndex++] = left;
        }
    }
#endif

    return rayHit;
}

// Lambert material scattering
float scatterLambert(const Ray ray, const Hit hit, out vec3 attenuation, out Ray scattered) {
    vec3 direction = hit.normal + randomUnitSphere();
    float l = dot(direction, direction);
    if ( l < 1e-8) {
        scattered.direction = hit.normal;
    } else {
        scattered.direction = direction * (1.0/sqrt(l));
    }
    scattered.origin.xyz = hit.position;
    scattered.origin.w = ray.origin.w; // time
    attenuation = hit.item.material.xyz;
    return 1.0;
}

// Metal material scattering
float scatterMetal(const Ray ray, const Hit hit, out vec3 attenuation, out Ray scattered) {
    float roughness = hit.item.material.w;
    vec3 reflected = reflect(normalize(ray.direction), hit.normal) + roughness * randomUnitSphere();
    scattered.direction = normalize(reflected);
    scattered.origin.xyz = hit.position;
    scattered.origin.w = ray.origin.w; // time
    attenuation = hit.item.material.xyz;
    return (dot(scattered.direction, hit.normal) > 0.0 ? 1.0 : 0.0);
}

// Schlick reflectance
float schlickReflectance(const float cosine, const float refractionRatio) {
    // Use Schlick's approximation for reflectance.
    float r0 = (1.0-refractionRatio) / (1.0+refractionRatio);
    r0 = r0*r0;
    return r0 + (1.0-r0)*pow((1.0 - cosine),5.0);
}

// Dielectric material scattering
float scatterDieletric(const Ray ray, const Hit hit, out vec3 attenuation, out Ray scattered) {
    float ior = hit.item.material.w;
    attenuation = vec3(1.0);
    float refractionRatio = hit.frontFace ? (1.0/ior) : ior;

    vec3 direction = normalize(ray.direction);
    vec3 refracted = refract(direction, hit.normal, refractionRatio);

    float cosTheta = min(dot(-direction, hit.normal), 1.0);
    float sinTheta = sqrt(1.0 - cosTheta*cosTheta);

    bool cannotRefract = refractionRatio * sinTheta > 1.0;

    if (cannotRefract || schlickReflectance(cosTheta, refractionRatio) > random(0.0, 1.0) )
        direction = reflect(direction, hit.normal);
    else
        direction = refract(direction, hit.normal, refractionRatio);


    scattered.direction = direction;
    scattered.origin.xyz = hit.position;
    scattered.origin.w = ray.origin.w; // time
    return 1.0;
}

float rayInner(const Ray ray, out Ray nextRay, inout vec3 color)
{
    Hit hit;
    if (intersectWorld(ray, 0.001, 1e8, hit)) {

        float result;
        vec3 attenuation;
        float type = hit.item.material.w;
        if (type < MaterialLambert+0.001) {
            result = scatterLambert(ray, hit, attenuation, nextRay);
        } else if (type <= MaterialMetal) {
            result = scatterMetal(ray, hit, attenuation, nextRay);
        } else {
            // MaterialDielectric
            result = scatterDieletric(ray, hit, attenuation, nextRay);
        }
        color *= result * attenuation;
        return result;
    }

    color *= rayBackgroundColor(ray);
    return 0.0;
}

vec3 rayColor(const Ray ray)
{
    vec3 color = vec3(1.0);
    const int maxNumRay = 10;
    int i = 0;
    Ray currentRay = ray;
    for (i = 0; i < maxNumRay; i++) {
        Ray nextRay;
        float hit = rayInner(currentRay, nextRay, color);
        if (hit == 0.0) {
            break;
        }
        currentRay = nextRay;
    }

    if (i==maxNumRay) {
        return vec3(0.0);
    }

    return color;
}

Ray getCameraRay(const vec2 sampleOffset, const in Camera camera)
{
    vec4 fragCoord = gl_FragCoord;

    // Normalized pixel coordinates (from 0 to 1)
    vec2 uv = (fragCoord.xy+sampleOffset)/iResolution.xy;

    // compute offset with disk to generate the blur
    vec3 rd = camera.lensRadius * randomUnitDisk();
    vec3 diskOffset = camera.u * rd.x + camera.v * rd.y;
    
    vec3 startPosition =  -camera.vecX*0.5 - camera.vecY*0.5 - camera.w;
    vec3 pixel = camera.vecX*uv.x + camera.vecY*uv.y;

    Ray ray;
    ray.origin.xyz = camera.position + diskOffset;
    ray.direction=normalize(startPosition + pixel - diskOffset);
    // time
    ray.origin.w = random(camera.time[0], camera.time[1]);
    return ray;
}

Camera computeCameraLookAt(const vec3 eye, const vec3 target, const float aspectRatio, const float fovy, const float aperture, const float focusDist, const float t0, const float t1)
{
    const vec3 vup = vec3(0.0, 1.0, 0.0);
    
    Camera camera;
    float h = tan(radians(fovy)/2.0);
    float height = h * 2.0;
    float width = height * aspectRatio;

    camera.position = eye;
    
    vec3 w = normalize(eye-target);
    vec3 u = cross(vup, w);
    vec3 v = cross(w, u);

    camera.u = u;
    camera.v = v;
    camera.w = w * focusDist;
    camera.vecX = camera.u * width * focusDist;
    camera.vecY = camera.v * height * focusDist;
    camera.time[0] = t0;
    camera.time[1] = t1;
    camera.lensRadius = aperture/2.0;
    return camera;
}


void mainImage( out vec4 fragColor, in vec2 fragCoord )
{
    randomSeed = int(fragCoord.x) + int(fragCoord.y) * int(iResolution.x);

//    const float aperture = 2.0;
//    const vec3 eye = vec3(3.0, 3.0, 2.0);
//    const vec3 target = vec3(0.0,0.0,-1.0);
//    const float distToFocus = length(eye-target);
    const vec3 eye = vec3(13.0,2.0,3.0);
    const vec3 target = vec3(0.0,0.0,0.0);
    const float distToFocus = 10.0;
    const float aperture = 0.1;
    const float t0 = 0.0;
    const float t1 = 1.0;
    float fovy =  20.0;  // + 100.0 * iMouse.y/iResolution.y;
    
    Camera camera = computeCameraLookAt(eye, target, iResolution.x/iResolution.y, fovy, aperture, distToFocus, t0, t1);

    const int numSamples = 10;
    const float invNumSamples = 1.0/float(numSamples);
    int i;
    vec3 col= vec3(0.0);
    for (i = 0; i < numSamples; i++) {
        vec2 offset = vec2(random(),random());
        Ray ray = getCameraRay(offset, camera);
        col += rayColor(ray);
    }

    // Output to screen
    fragColor = vec4(sqrt(col * invNumSamples),1.0);
}

#ifdef DEBUG
void main() {

  vec4 color;
  mainImage(color, gl_FragCoord.xy);
  frag_color = color;
}
#endif
